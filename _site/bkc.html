<!doctype html>

<html class="no-js" lang="en">

<head>

	<link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="workingpaper.co" />
	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	Working Paper

	Personal Theme by https://jekyllthemes.io
	Premium + free Jekyll themes for your blog or website.

	- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<!-- Page Info -->
	<link rel="shortcut icon" href="/images/WPLogo.png">
	<title>7 March 2019 Sign Up – Working Paper</title>
	<meta name="description" content="">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="7 March 2019 Sign Up – Working Paper">
	<meta name="twitter:description" content="">
	<meta name="twitter:image:src" content="http://0.0.0.0:4000/images/nodemcu-bkc/3.jpg">

	<!-- Facebook OpenGraph -->
	<meta property="og:title" content="7 March 2019 Sign Up – Working Paper" />
	<meta property="og:description" content="" />
	<meta property="og:image" content="http://0.0.0.0:4000/images/nodemcu-bkc/3.jpg" />

	
	<!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Muli:300,400,600,700" rel="stylesheet">
	

	<!-- Styles -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/style.css">
	
	<!-- Icons -->
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/solid.js" integrity="sha384-GXi56ipjsBwAe6v5X4xSrVNXGOmpdJYZEEh/0/GqJ3JTHsfDsF8v0YQvZCJYAiGu" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/brands.js" integrity="sha384-0inRy4HkP0hJ038ZyfQ4vLl+F4POKbqnaUB6ewmU4dWP0ki8Q27A0VFiVRIpscvL" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/fontawesome.js" integrity="sha384-NY6PHjYLP2f+gL3uaVfqUZImmw71ArL9+Roi9o+I4+RBqArA2CfW1sJ1wkABFfPe" crossorigin="anonymous"></script>

	
	<!-- Custom Styles -->
	<style></style>
	

	
	<!-- Analytics Code -->
	
	

	
	<!-- Extra Header JS Code -->
	
	
	<script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(66370106);</script>
<script async src="//static.getclicky.com/js"></script>
</head>


<body class="loading" data-site-url="http://0.0.0.0:4000" data-page-url="/bkc">


	<header class="header">

	<div class="wrap">

		
		<a href="/" class="header__logo">
			<img src="/images/WPLogoWithText.png" class="header__logo__img">
		</a>
		

		<div class="menu">
			<div class="menu__toggle js-menu-toggle">
				<div class="menu__toggle__icon"><span></span></div>
			</div>
			<div class="menu__wrap">
				<ul class="menu__list">
					
					<li class="menu__list__item">
						<a href="/" class="menu__list__item__link">Home</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/blog/" class="menu__list__item__link">Updates</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/subscribe" class="menu__list__item__link">Subscribe</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/andrew-gruen" class="menu__list__item__link">Andrew Gruen</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/contact" class="menu__list__item__link">Contact</a>
					</li>
					
				</ul>
			</div>
		</div>

	</div>

</header>


	<div class="loader"><svg width="120" height="30" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle></svg></div>

	<div class="page-loader"></div>

	
	<div class="page">

		<div class="page__content" data-page-title="7 March 2019 Sign Up – Working Paper">

			<section class="hero hero--single">

	<div class="hero__image" style="background-image: url(/images/nodemcu-bkc/3.jpg)">
		<div class="hero__overlay"></div>
	</div>

	<div class="wrap">

		<h1>7 March 2019 Sign Up</h1>
		<p>Join the Geeks Hour to build your own IoT Temperature and Humidity sensor</p>

	</div>

</section>

<section class="single">

	<div class="wrap">

		<article class="single-post">

			<h2 id="overview">Overview</h2>
<p>Hi everyone –</p>

<p>I’ve been playing around with some very simple hardware that makes for exceptionally good home IoT devices at very low prices… and without connection to a surveillance cloud.</p>

<p>It’s all trivially easy to do – but, the documentation online is truly awful, meaning it took me a few weeks to get everything worked out.</p>

<p>So, instead, I’m hosting a geeks hour to show you how to do it easily.</p>

<p>We’ll chat about <a href="https://homebridge.io/">two</a> <a href="https://www.home-assistant.io/">different</a> automation hubs (both of which can run on a raspberry pi or on another machine in a docker container) and some exceptionally simple/inexpensive wifi remote sensor hardware (<a href="nodemcu.com">NodeMCU</a> on <a href="https://www.aliexpress.com/item/Update-Industry-4-0-New-esp8266-NodeMCU-v2-Lua-WIFI-networking-development-kit-board-based-on/32358722888.html?spm=a2g0s.9042311.0.0.49264c4d5tGDeK">ESP8266 microcontrollers</a>, with some simple <a href="https://www.aliexpress.com/item/High-Precision-AM2302-DHT22-Digital-Temperature-Humidity-Sensor-Module-For-Uno-R3/32292594513.html?spm=2114.search0104.3.38.70de7323dWSi7y&amp;ws_ab_test=searchweb0_0,searchweb201602_2_10065_10068_10130_10890_10547_319_10546_317_10548_10545_10696_453_10084_454_10083_433_10618_431_10307_537_536_10059_10884_10887_100031_321_322_10103,searchweb201603_54,ppcSwitch_0&amp;algo_expid=476abcb2-2728-4905-8d20-b58a1628c653-5&amp;algo_pvid=476abcb2-2728-4905-8d20-b58a1628c653">temperature and humidity sensors</a>).</p>

<p>Andrew</p>

<h2 id="prerecs">Prerecs</h2>
<p>To prepare for the workshop, please download the following items to your local machine:</p>
<ul>
  <li><a href="https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers">ESP8266 Serial Drivers</a> from <a href="silabs.com">Silicon Labs</a></li>
  <li><a href="nodemcu-master-15-modules-2019-01-06-01-35-33-float.bin">ESP8266 Firmware</a> (I’ve pre-compiled this for you and am hosting it… but if you want to build your own, it’s easy, and you can do so <a href="https://nodemcu-build.com">here</a>, just be sure to include the needed modules including wifi, your sensor type, etc. Again, contact me if you want more info.)</li>
  <li><a href="https://esp8266.ru/esplorer/">ESPlorer</a> (requires java)</li>
  <li><a href="https://github.com/marcelstoer/nodemcu-pyflasher/releases">NodeMCU PyFlasher</a> (Mac and Windows availible, if you’re running linux, you can either build it from source or write me and I’ll get you going.)</li>
  <li>Software for your NodeMCU device (in this case, <a href="https://github.com/NorthernMan54/homebridge-mcuiot/tree/master/nodemcu/lua">homebridge-mcuiot</a> – download all the Lua files, or clone the whole repo)</li>
</ul>

<h2 id="session-instructions">Session Instructions</h2>

<h3 id="preparing-your-hardware">Preparing your hardware</h3>
<ol>
  <li>Your kit should come with four parts:
 <img src="/images/nodemcu-bkc/1.jpg" alt="" />
    <ol>
      <li>NodeMCU Microcontroller</li>
      <li>AM2302 (DHT22) Temperature/Humidity Sensor</li>
      <li>Cables with pin adaptors</li>
      <li>Micro USB cable</li>
    </ol>
  </li>
  <li>Putting software on the Microcontroller (please be sure you’ve already downloaded everything in the <a href="#prerecs">Prerecs</a> section above)
    <ol>
      <li>First, we’ll install the <a href="https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers">Silicon Labs drivers</a> for your system</li>
      <li>Next, we’ll use the  the <a href="https://github.com/marcelstoer/nodemcu-pyflasher/releases">NodeMCU PyFlasher</a> to load the <a href="nodemcu-master-15-modules-2019-01-06-01-35-33-float.bin">firmware</a> onto the microcontroller
        <ul>
          <li>Connect your microcontroler to your laptop with the included USB cable.
 <img src="/images/nodemcu-bkc/2.jpg" alt="" /></li>
          <li>Open PyFlasher, select the select the correct serial port from the list, and pick the correct connection speed and type.  The ones in the screenshot seem to work well for these devices, but your milage may vary… Be sure to try things if they don’t work for you.</li>
          <li>Select the firmware to load, choose erase flash, and then click the big ‘Flash NodeMCU’ Button!
 <img src="/images/nodemcu-bkc/pyflasher.png" alt="" /></li>
        </ul>
      </li>
    </ol>
  </li>
  <li>Now that we have NodeMCU on your microcontroller, we need to install the software to read from the sensor and publish the data over HTTP.  For this project, we’re using <a href="https://github.com/NorthernMan54/homebridge-mcuiot/tree/master/nodemcu/lua">homebridge-mcuiot</a>.  We’ll use the <a href="https://esp8266.ru/esplorer/">ESPlorer</a> to actually “install” the software on the microcontroller.
    <ol>
      <li>After downloading all the files in the <code class="highlighter-rouge">lua</code> folder, we need to edit a two of them.
 <img src="/images/nodemcu-bkc/lua.png" alt="" />
        <ul>
          <li>First, we’ll add the correct WiFi information to the <code class="highlighter-rouge">passwords_sample.lua</code> file.  Note the file has blanks for two WiFi networks.  Delete the second one.  After you’re finished, rename the file <code class="highlighter-rouge">passwords.lua</code>.
 <img src="/images/nodemcu-bkc/passwords.png" alt="" /></li>
          <li>Second, we need to edit the <code class="highlighter-rouge">config.lua</code> file.  Here we tell the microcontroller which type of sensor we’re using (line 4 <code class="highlighter-rouge">DHT</code>), that we do not want the LEDs running all the time (line 8 <code class="highlighter-rouge">2</code>), and which pin we will use for data from the sensor (line 17 <code class="highlighter-rouge">5</code> – we’ll use pin 5, because it’s next to the ground and power pins).
 <img src="/images/nodemcu-bkc/config.png" alt="" /></li>
        </ul>
      </li>
      <li>Now, we need to connect to our functioning microcontroller using ESPlorer.  To do so, we open the app, select the correct serial port, enable <code class="highlighter-rouge">DTR</code> and <code class="highlighter-rouge">RTS</code> and set the bitrate to <code class="highlighter-rouge">115200</code>.  Then we click the big <code class="highlighter-rouge">open</code> button.
 <img src="/images/nodemcu-bkc/esplorer-setup.png" alt="" /></li>
      <li>Once connected, we can upload the <code class="highlighter-rouge">homebridge-mcuiot</code> software.  To do so, we must upload six files individually, by clicking the upload button, finding them on our system, and clicking open for each.  The five files we need to upload are:
        <ul>
          <li>config.lua</li>
          <li>led.lua</li>
          <li>main.lua</li>
          <li>passwords.lua</li>
          <li>setup.lua</li>
          <li>test.lua
 <img src="/images/nodemcu-bkc/esplorer-upload.png" alt="" /></li>
        </ul>
      </li>
      <li>After uploading all the files, we can now test our microcontroller to see if it can connect to WiFi.  We use the ESplorer to run the test by selecting <code class="highlighter-rouge">dofile("")</code> from the action menu; editing it to add our test tool, so it reads <code class="highlighter-rouge">dofile("test.lua")</code>, and then clicking the send button.  If the microcontroller panics, it will reboot.  Run the test file again. (This happens with regularity.)
 <img src="/images/nodemcu-bkc/esplorer-test.png" alt="" />
 If the test is successful, ESPlorer will display the connected WiFi network and the device’s IP address.
 <img src="/images/nodemcu-bkc/esplorer-test-running.png" alt="" /></li>
    </ol>
  </li>
  <li>Next, we’ll attach our sensor to the microcontroller.
    <ol>
      <li>Close ESplorer and unplug your microcontroller from your laptop.</li>
      <li>Attach your pin cables to the <code class="highlighter-rouge">3V3</code>, <code class="highlighter-rouge">GND</code>, and <code class="highlighter-rouge">D5</code> pins.  They’re all next to one another.
 <img src="/images/nodemcu-bkc/4.jpg" alt="" /></li>
      <li>Using the colors of your pin cables as your guide, make the following connections on your AM2302 sensor module:
        <ul>
          <li><code class="highlighter-rouge">3V3</code> –&gt; <code class="highlighter-rouge">VCC</code> (middle pin)</li>
          <li><code class="highlighter-rouge">GND</code> –&gt; <code class="highlighter-rouge">GND</code> (bottom pin)</li>
          <li><code class="highlighter-rouge">D5</code>  –&gt; <code class="highlighter-rouge">DAT</code> (top pin)
 <img src="/images/nodemcu-bkc/5.jpg" alt="" /></li>
        </ul>
      </li>
    </ol>
  </li>
  <li>Now we can re-connect the microcontroller to your laptop via USB, and see if it is pulling data from the sensor.
    <ol>
      <li>After re-connecting, open ESPlorer and open the connection again (it should have saved your settings from before).</li>
      <li>Run the test file again, by entering <code class="highlighter-rouge">dofile("test.lua")</code> into the action menu and clicking send.</li>
      <li>If you connected the sensor correctly, ESPlorer will show you the readout from the sensor, as illustrated below.
 <img src="/images/nodemcu-bkc/esplorer-sensor-test.png" alt="" /></li>
    </ol>
  </li>
  <li>To access the data remotely, you can visit the IP address shown by ESPlorer in your browser.  It’s a simple JSON formatted file, accessible by HTTP.  You can incorporate this into your own application, or use many different home automation tools to read this file.  If you use the Apple ecosystem, you can install the client portion of <a href="https://github.com/NorthernMan54/homebridge-mcuiot/">homebridge-mcuiot</a> along with <a href="https://homebridge.io/">homebridge</a>.  There is good documentation for this on the sites for both pieces of software.
<img src="/images/nodemcu-bkc/browser.png" alt="" /></li>
  <li>Once you’re ready to perminently install your sensor, we need to add one more file to our microcontroller, <code class="highlighter-rouge">init.lua</code>, which tells it to run the homebridge-mcuiot software on boot.  To do so, click the upload button, find the <code class="highlighter-rouge">init.lua</code> file downloaded earlier, and click open.</li>
  <li>Congrats!  Go plug your controller in somewhere!</li>
</ol>


		</article>

	</div>

</section>

		</div>

	</div>


	<footer class="footer">

	<div class="wrap">

		<p class="footer__text">Research. Driven. Results.</p>

		<div class="footer__copyright">
			<span>© 2017 - 2019 Working Paper</span>
		</div>

		<ul class="socials">
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</ul>

	</div>

</footer>


	<!-- Javascript Assets -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="/js/personal-min.js"></script>

	
	<!-- Extra Footer JS Code -->
	
	


</body>

</html>